/**
 * Ajax.JS
 * @author	Tom Flidr | tomflidr(at)gmail(dot)com
 * @url		https://github.com/tomFlidr/ajax.js
 * @licence	https://tomflidr.github.io/ajax.js/LICENSE.md
 * @version	1.0.9
 * @date	2022-03-29
 * @example
 *
 *    var xhr = Ajax.load(<Ajax.cfg.Load>{
 *       url: 'https://tomflidr.github.io/ajax.js/books.json',
 *       method: 'POST', // GET|POST|OPTION|HEAD...
 *       data: { anything: ["to", "serialize"] },
 *       success: (data?: any, statusCode?: number, xhr?: XMLHttpRequest|null, requestId?: number, url?: string, type?: string) => {},
 *       type: 'json', // json|jsonp|xml|html|text
 *       error: (responseText?: string, statusCode?: number, xhr?: XMLHttpRequest|null, errorObj?: Error|null, errorEvent?: Event|null, requestId?: number, url?: string, type?: string) => {},
 *       headers: {},
 *       async: true
 *    });
 *
 */
/**
 * @typedef		JsonpRequest			JsonpRequest driving object.
 * @type		{Object}
 *
 * @property	{String}	url			Full appended &lt;script&gt; tag src attribute value.
 * @property	{Number}	id			Request id.
 * @property	{Function}	abort		Function to abort JSONP request.
*/
var Ajax=function(){};Ajax.handlers={before:[],success:[],abort:[],error:[]};Ajax.defaultHeaders={"X-Requested-With":"XmlHttpRequest","Content-Type":"application/x-www-form-urlencoded"};Ajax.jsonpCallbackParam="callback";Ajax.aa="JsonpCallback";Ajax.J=0;Ajax.beforeLoad=function(a){Ajax.handlers.before.push(a);return Ajax};Ajax.onSuccess=function(a){Ajax.handlers.success.push(a);return Ajax};Ajax.onAbort=function(a){Ajax.handlers.abort.push(a);return Ajax};
Ajax.onError=function(a){Ajax.handlers.error.push(a);return Ajax};Ajax.get=function(){var a=new Ajax;return a.s.apply(a,[].slice.apply(arguments)).u()};Ajax.post=function(){var a=new Ajax;return a.s.apply(a,[].slice.apply(arguments)).u("post")};Ajax.load=function(a){return(new Ajax).s(a.url,a.data,a.success,a.type,a.error,a.headers,a.async).u(a.method)};
Ajax.prototype={toString:function(){return"[object Ajax]"},s:function(a,b,c,d,e,g,f){function h(){}this.url=a||"";this.data=b||{};this.b=c||h;this.type=(void 0===d?"":d).toLowerCase()||"auto";this.error=e||h;this.headers=g||{};this.async="undefined"==typeof f?!0:f;this.result={b:!1,data:{}};this.g=this.f=null;return this},u:function(a){this.h=!!document.all;return"jsonp"==this.type?this.S():this.T(a).a},S:function(){var a=this,b=document.createElement("script"),c=a.N();a.i=b;a.c=Ajax.J++;a.l=Ajax.aa+
a.c;Ajax[a.l]=function(b){a.P(b)};a.data[Ajax.jsonpCallbackParam]=this.M()+"."+a.l;a.D("get");b.setAttribute("src",a.url);a.w();a.h?(b.attachEvent("onreadystatechange",a.m()),b=c.insertAdjacentElement("beforeEnd",b)):(b.setAttribute("async","async"),b.addEventListener("error",a.m(),!0),b=c.appendChild(b));return{url:a.url,id:a.c,abort:function(){a.o();a.v()}}},P:function(a){this.result.b=!0;this.o();this.result.data=a;this.b(a,200,null,this.c,this.url,this.type);this.B()},m:function(){var a=this,
b=a.i;return a.h?function(c){c=c||window.event;"loaded"!=b.readyState||a.result.b||a.G(c)}:function(b){a.G(b)}},G:function(a){var b=this.m();this.h?this.i.detachEvent("onreadystatechange",b):this.i.removeEventListener("error",b,!0);this.o();this.f=a;this.H();this.error("",0,null,null,a,this.c,this.url,this.type);this.A()},o:function(){this.i.parentNode.removeChild(this.i);this.h?Ajax[this.l]=void 0:delete Ajax[this.l]},T:function(a){a=(void 0===a?"get":a).toLowerCase();var b=this.D(a);this.c=Ajax.J++;
this.a=this.K();this.U();this.a.open(a,this.url,this.async);this.ba();this.w();this.V(a,b);return this},U:function(){function a(a){4==c.readyState&&b.R(a)}var b=this,c=b.a;b.h?b.a.attachEvent("onreadystatechange",a):b.a.addEventListener("readystatechange",a)},R:function(a){a=a||window.event;scope=this;statusCode=scope.a.status;199<statusCode&&300>statusCode?(scope.W(),scope.I()):0===statusCode?scope.v():(scope.result.b=!1,scope.f=a,scope.g=Error("Http Status Code: "+statusCode),scope.I())},V:function(a,
b){var c=this.a;"get"==a?c.send():"post"==a&&c.send(b)},I:function(){var a=this.a;this.result.b?(a=[this.result.data,a.status,a,this.c,this.url,this.type],this.b.apply(null,a),this.B()):(a=[a.responseText,a.status,a,this.f,this.g,this.c,this.url,this.type],this.error.apply(null,a),this.A(),this.H())},W:function(){"auto"==this.type&&this.Y();this.X()},X:function(){var a=this.a;"json"==this.type?this.Z():"xml"==this.type||"html"==this.type?this.$():"text"==this.type&&(this.result.data=a.responseText,
this.result.b=!0)},Y:function(){var a=this.O();this.type="text";-1<a.indexOf("javascript")||-1<a.indexOf("json")?this.type="json":-1<a.indexOf("html")?this.type="html":-1<a.indexOf("xml")&&(this.type="xml")},Z:function(){var a=window,b=this.a.responseText;a.JSON||this.F();try{this.result.data=a.JSON.parse(b),this.result.b=!0}catch(c){try{this.result.data=(new Function("return "+b))(),this.result.b=!0}catch(d){}this.g=c}},$:function(){var a={},b=window,c=this.a.responseText,d=b.DOMParser;try{d?(a=
new d,this.result.data=a.parseFromString(c,"application/xml")):(a=new b.ActiveXObject("Microsoft.XMLDOM"),a.async=!1,this.result.data=a.loadXML(c)),this.result.b=!0}catch(e){this.g=e}},O:function(){var a=this.L(),b=a.indexOf("/");-1<b&&(a=a.substr(b+1));return a},L:function(){var a=this.a.getResponseHeader("Content-Type"),b=a.indexOf(";"),a=0<a.length?a.toLowerCase():"";-1<b&&(a=a.substr(0,b));return a},K:function(){var a,b=window,c=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];
if(b.XMLHttpRequest)a=new b.XMLHttpRequest;else for(var d=0,e=c.length;d<e;d+=1)try{a=new b.ActiveXObject(c[d])}catch(g){}return a},ba:function(){var a=this.a,b=this.headers,c=Ajax.defaultHeaders,d;for(d in b)a.setRequestHeader(d,b[d]);for(d in c)b[d]||a.setRequestHeader(d,c[d])},D:function(a){var b="?",c=this.url,d=c.indexOf(b);a=a.toLowerCase();"get"==a?(this.data._=+new Date,a=this.C(),-1<d&&(b=d==c.length-1?"":"&"),this.url=c+b+a):a=this.C();return a},C:function(){var a=this.data;if("string"==
typeof a)return a;window.JSON||this.F();return this.ca()},ca:function(){var a=this.data,b=[],c,d=window,e;for(e in a)c="object"==typeof a[e]?d.JSON.stringify(a[e]):a[e].toString(),b.push(e+"="+c);return b.join("&")},F:function(){window.JSON=function(){function a(a){return 10>a?"0"+a:a}function b(a,e){var g,f,h,k;g=/["\\\x00-\x1f\x7f-\x9f]/g;var l;switch(typeof a){case "string":return g.test(a)?'"'+a.replace(g,function(a){var b=c[a];if(b)return b;b=a.charCodeAt();return"\\u00"+Math.floor(b/16).toString(16)+
(b%16).toString(16)})+'"':'"'+a+'"';case "number":return isFinite(a)?String(a):"null";case "boolean":case "null":return String(a);case "object":if(!a)return"null";if("function"===typeof a.toJSON)return b(a.toJSON());g=[];if("number"===typeof a.length&&!a.propertyIsEnumerable("length")){k=a.length;for(f=0;f<k;f+=1)g.push(b(a[f],e)||"null");return"["+g.join(",")+"]"}if(e)for(k=e.length,f=0;f<k;f+=1)h=e[f],"string"===typeof h&&(l=b(a[h],e))&&g.push(b(h)+":"+l);else for(h in a)"string"===typeof h&&(l=
b(a[h],e))&&g.push(b(h)+":"+l);return"{"+g.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"};var c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:b,parse:function(a,b){function c(a,d){var f,m;if(d&&"object"===typeof d)for(f in d)Object.prototype.hasOwnProperty.apply(d,[f])&&(m=c(f,d[f]),
void 0!==m&&(d[f]=m));return b(a,d)}var f;if(/^[\],:{}\s]*$/.test(a.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return f=eval("("+a+")"),"function"===typeof b?c("",f):f;throw new SyntaxError("parseJSON");}}}()},N:function(){for(var a=document.body;null!==a.previousSibling&&void 0!==a.previousSibling&&(a=a.previousSibling,"head"!=a.nodeName.toLowerCase()););return a},w:function(){this.j("before","jsonp"==this.type?
[null]:[this.a])},B:function(){var a=this.a,b=this.result.data;this.j("success","jsonp"==this.type?[b,200,null]:[b,a.status,a])},v:function(){this.j("abort","jsonp"==this.type?[null]:[this.a])},A:function(){var a=this.a;this.j("error","jsonp"==this.type?["",0,null,null,this.f]:[a.responseText,a.status,a,this.da,null])},j:function(a,b){function c(){}var d=Ajax.handlers[a];b.push(this.c,this.url,this.type);for(var e=0,g=d.length;e<g;e+=1)c=d[e],"function"==typeof c&&c.apply(null,b)},H:function(){var a=
window,b=this.c,c=this.url,d=this.type,e=this.g,g=this.f,f=this.a;a.console&&("jsonp"==d?a.console.log(b,c,d,0,g):a.console.log(b,c,d,f,f.status,f.responseText,e,e.stack))},M:function(){var a=this.toString();return a.substr(8,a.length-9)}};
